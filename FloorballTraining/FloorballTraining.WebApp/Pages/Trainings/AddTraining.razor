@page "/addtraining"
@inject IAddTrainingUseCase AddTrainingUseCase
@inject NavigationManager NavigationManager

<MudText Typo="Typo.h4">Nový trénink</MudText>


<EditForm Model="@_training" OnValidSubmit="Submit">
    <FluentValidationValidator/>
    <ValidationSummary />
    <MudPaper Elevation="0" Class="d-flex flex-wrap">
        @*Field*@
        <MudPaper Elevation="0" >
    
            <MudTextField Label="Název" @bind-Value="_training.Name" For="() => _training.Name" />
            <MudTextField Label="Popis" @bind-Value="_training.Description" For="() => _training.Description" Lines="6" Variant="Variant.Outlined" Margin="Margin.Dense" Class="my-5" />

            <MudPaper Elevation="0" Class="d-inline-flex gap-4">
                <MudPaper Elevation="0">
                    <MudText>Počet osob: @_training.Persons</MudText>
                    <MudTextField T="int" @bind-Value="_training.Persons" For="() => _training.Persons"/>
                    <MudSlider T="int" @bind-Value="@_training.Persons" Min="1" Max="50" Immediate="true"/>
                </MudPaper>

                <MudPaper Elevation="0">
                    <MudText>Doba trvání: @_training.Duration</MudText>
                    <MudTextField T="int" @bind-Value="_training.Duration" For="() => _training.Duration" />
                    <RangeSlider @bind-ValueHigh="_training.Duration" MinValue="1" MaxValue="180" />
                </MudPaper>
            </MudPaper>
        </MudPaper>
        
        
        <MudExpansionPanels MultiExpansion="true" Dense="true">

            <MudExpansionPanel IsInitiallyExpanded="true" Text="Tréninkové části" Class="my-4" Style="font-size: 2em; font-weight: bold;">

                <MudButton StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" Color="Color.Success" OnClick="AddTrainingPart" DisableElevation="true" Variant="Variant.Filled" Class="my-2">Nová tréninková část</MudButton>

                @*TrainingParts*@
                <TrainingPartsComponent TrainingParts="_training.TrainingParts"></TrainingPartsComponent>


            </MudExpansionPanel>


            @*<MudExpansionPanel IsInitiallyExpanded="true" Text="Vybavení" Class="my-4" Style="font-size: 2em; font-weight: bold;">
                @foreach (var equipment in Training.GetNeededEquipment())
                {
                    <MudText>@equipment</MudText>

                }

            </MudExpansionPanel>*@

            <MudExpansionPanel IsInitiallyExpanded="true" Text="Vybavení" Class="my-4" Style="font-size: 2em; font-weight: bold;"></MudExpansionPanel>

        </MudExpansionPanels>




    </MudPaper>
    
    @*Buttons*@
    <MudPaper Elevation="0" Class="d-inline-flex my-2">
        <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Primary" OnClick="Cancel">Cancel</MudButton>
        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" @onkeypress:preventDefault>OK</MudButton>
    </MudPaper>
</EditForm>


@code {
    private readonly Training _training = new();
    
    private async Task Submit()
    {
        await AddTrainingUseCase.ExecuteAsync(_training);
        NavigationManager.NavigateTo("/trainings");
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/trainings");
    }

    private void AddTrainingPart()
    {
        _training.TrainingParts.Add(new TrainingPart
        {
                Name = $"{_training.TrainingParts.Count + 1}",
                Order = _training.TrainingParts.Count + 1
        });
    }
}
