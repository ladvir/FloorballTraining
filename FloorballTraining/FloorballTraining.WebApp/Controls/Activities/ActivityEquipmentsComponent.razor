@using FloorballTraining.WebApp.Pages.Equipments
@inject IViewEquipmentByNameUseCase ViewEquipmentByNameUseCase
@inject IAddEquipmentUseCase AddEquipmentUseCase

@if (!ReadOnly)
{
    <MudPaper Elevation="0" Class="d-inline-flex flex-wrap gap-2 my-2 align-baseline align-items-baseline align-content-end">
        <MudTextField Label="Nové vybavení" @bind-Value="_newEquipment" />
        <MudChip Icon="@Icons.Material.Filled.Add" Variant="Variant.Outlined" Color="Color.Success" OnClick="AddEquipment">Přidat vybavení</MudChip>
    </MudPaper>
}

<MudPaper Elevation="0" Class="align-content-start my-2 gap-1" Style="columns: 10rem auto;">
    @foreach (var possibleValue in _equipments)
    {
        <MudCheckBox T="bool" ReadOnly="@ReadOnly" Color="Color.Success" Class="text-break" Dense="true" Checked="@SelectedValues.Contains(possibleValue)" CheckedChanged="@((isChecked) => CheckboxChanged(isChecked, possibleValue))"> @possibleValue.Name</MudCheckBox>
    }
</MudPaper>


@code {
    [Parameter]
    public List<Equipment> SelectedValues { get; set; } = new();

    [Parameter]
    public bool ReadOnly { get; set; }

    [Parameter]
    public EventCallback<List<Equipment>> SelectedValuesChanged { get; set; }

    private string _newEquipment = string.Empty;
    private List<Equipment> _equipments = new();

    protected override async Task OnInitializedAsync()
    {
        await Refresh();
    }

    private async Task Refresh()
    {
        _equipments = (await ViewEquipmentByNameUseCase.ExecuteAsync()).ToList();
        _newEquipment = string.Empty;
    }
    
    private async Task CheckboxChanged(bool isChecked, Equipment value)
    {
        if (isChecked)
        {
            SelectedValues.Add(value);
        }
        else
        {
            SelectedValues.Remove(value);
        }

        await SelectedValuesChanged.InvokeAsync(SelectedValues);
    }

    private async Task AddEquipment()
    {
        if(!string.IsNullOrEmpty(_newEquipment))
        {
            var equipment = new Equipment
            {
                Name = _newEquipment
            };
            await AddEquipmentUseCase.ExecuteAsync(equipment);
            
            await Refresh();
        }
    }

}





    

